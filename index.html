<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Clasificados</title>
</head>
<body>
  <h1>Publicar Clasificado</h1>
  <form id="form-clasificado">
    <input type="text" id="nombre" placeholder="Tu nombre" required>
    <textarea id="mensaje" placeholder="Escribe tu anuncio" required></textarea>
    <button type="submit">Publicar</button>
  </form>

  <h2>Clasificados Publicados</h2>
  <ul id="lista-clasificados"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ⚠️ Pega aquí tu configuración de Firebase:
    const firebaseConfig = {
  apiKey: "AIzaSyAy4pQUJjWe-jYYToxqxfIoOJBgvS4aWwg",
  authDomain: "clasificados-606d5.firebaseapp.com",
  projectId: "clasificados-606d5",
  storageBucket: "clasificados-606d5.firebasestorage.app",
  messagingSenderId: "809246084580",
  appId: "1:809246084580:web:373891ac187c118d2c4bf1",
  measurementId: "G-P6BPEPPS0E"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function guardarClasificado(data) {
      try {
        await addDoc(collection(db, "clasificados"), {
          ...data,
          fecha: Timestamp.now()
        });
      } catch (e) {
        console.error("Error al guardar:", e);
        alert("No se pudo publicar el anuncio.");
      }
    }

    document.getElementById("form-clasificado").addEventListener("submit", (e) => {
      e.preventDefault();
      const data = {
        nombre: document.getElementById("nombre").value.trim(),
        mensaje: document.getElementById("mensaje").value.trim()
      };
      if (data.nombre && data.mensaje) {
        guardarClasificado(data);
        e.target.reset();
      }
    });

    const lista = document.getElementById("lista-clasificados");
    const q = query(collection(db, "clasificados"), orderBy("fecha", "desc"));

    onSnapshot(q, (snapshot) => {
      lista.innerHTML = "";
      snapshot.forEach(doc => {
        const d = doc.data();
        const li = document.createElement("li");
        const fecha = d.fecha.toDate().toLocaleString();
        li.textContent = `[${fecha}] ${d.nombre}: ${d.mensaje}`;
        lista.appendChild(li);
      });
    });
  </script>
</body>
</html>
